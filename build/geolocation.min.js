function t(t){let e=t+"_from_back";if(window[e])return'<p id="p_'+t+'">'+window[e]+"</p>"}document.head.appendChild(document.createElement("style")).textContent=".modal .overlay~*{position:relative;box-shadow:none;border-radius:0.2em;border:1px solid #aaa;overflow:hidden;text-align:left;background:#fff;margin-bottom:0.6em;padding:0;transition:all 0.3s ease;}.modal .overlay~.hidden,.modal .overlay~:checked+*,.modal .overlay:checked+*{font-size:0;padding:0;margin:0;border:0;}.modal .overlay~*>*{max-width:100%;display:block;}.modal .overlay~* header,.modal .overlay~* section,.modal .overlay~*>p{padding:0.6em 0.8em;}.modal .overlay~* section{padding:0.6em 0.8em 0;}.modal .overlay~* header{font-weight:bold;position:relative;border-bottom:1px solid #aaa;}.modal .overlay~* header h3{padding:0;margin:0 2em 0 0;line-height:1;display:inline-block;vertical-align:text-bottom;}.modal .overlay~* footer{padding:0.8em;}.modal .overlay~* p{margin:0.3em 0;}.modal .overlay~* p:first-child{margin-top:0;}.modal .overlay~* p:last-child{margin-bottom:0;}.modal .overlay~* .close{position:absolute;top:0.4em;right:0.3em;font-size:1.2em;padding:0 0.5em;cursor:pointer;width:auto;}.modal .overlay~* .close:hover{color:#ff4136;}.modal .overlay~* .button_close{float:right;margin-bottom:0.5rem;}.modal .overlay~* .button_shoose{float:left;margin-bottom:0.5rem}.modal{text-align:center;}.modal>input{display:none;}.modal>input~*{opacity:0;max-height:0;overflow:hidden;}.modal .overlay{top:0;left:0;bottom:0;right:0;position:fixed;margin:0;border-radius:0;background:rgba(17,17,17,0.2);transition:all 0.3s;z-index:100000;}.modal .overlay:before,.modal .overlay:after{display:none;}.modal .overlay~*{border:0;position:fixed;top:50%;left:50%;transform:translateX(-50%) translateY(-50%) scale(0.2,0.2);z-index:1000000;transition:all 0.3s;}.modal>input:checked~*{display:block;opacity:1;max-height:10000px;transition:all 0.3s;}.modal>input:checked~.overlay~*{max-height:90%;overflow:auto;-webkit-transform:translateX(-50%) translateY(-50%) scale(1,1);transform:translateX(-50%) translateY(-50%) scale(1,1);}@media (max-width:60em){.modal .overlay~*{min-width:90%;}}.button{border-radius:0.2em;border:1px solid #aaa;padding:0.5rem;}";let e='<div class="">\t<label for="modal_1" class="">\t\t<span class="mr1">&#128205;</span>\t\t<span id="location">'+city_from_back+'&ensp;&#8250;\t\t</span>\t</label>\t<div class="modal">\t\t<input id="modal_1" type="checkbox" />\t\t<label for="modal_1" class="overlay "></label>\t\t<article class="">\t\t\t<header class="bgcolor">\t\t\t\t<p>&nbsp;</p>\t\t\t\t<label for="modal_1" class="close">&times;</label>\t\t\t</header>\t\t\t<section class="content bgcontent" id="clients_location_message">'+t("city")+t("region")+'</section >\t\t\t<footer class="bgcontent">\t\t\t\t<label for="show_city_select" class="button button_shoose" id="shoose_location">\t\t\t\t\tВыбрать\t\t\t\t</label>\t\t\t\t<label for="modal_1" class="button button_close">\t\t\t\t\tЗакрыть\t\t\t\t</label>\t\t\t</footer>\t\t</article >\t</div >\t<div class="modal">\t\t<input id="show_city_select" type="checkbox" />\t\t<label for="show_city_select" class="overlay "></label>\t\t<article class="">\t\t\t<header class="bgcolor">\t\t\t\t<p>&nbsp;</p>\t\t\t\t<label for="show_city_select" class="close">&times;</label>\t\t\t</header>\t\t\t<section class="content bgcontent" id="">\t\t\t\t<input type="text" name="city_search_input" id="city_search_input" placeholder="Поиск">\t\t\t\t\t<select id="shoose_district" class="select mb1">\t\t\t\t\t\t<option>Округ</option>\t\t\t\t\t</select>\t\t\t\t\t<select id="shoose_region" class="select mb1" disabled>\t\t\t\t\t\t<option>Регион (область)</option>\t\t\t\t\t</select>\t\t\t\t\t<select id="shoose_city" class="select" disabled>\t\t\t\t\t\t<option>Город</option>\t\t\t\t\t</select>\t\t\t</section>\t\t\t<footer class="bgcontent">\t\t\t\t<button id="save_city" class="button">\t\t\t\t\tВыбрать\t\t\t\t</button>\t\t\t\t<label for="show_city_select" class="button button_close">\t\t\t\t\tЗакрыть\t\t\t\t</label>\t\t\t</footer>\t\t</article>\t</div></div >';function o({city:t,adress:e}){const o=document.getElementById("location"),n=document.getElementById("clients_location_message");document.getElementById("shoose_location");const i=document.getElementById("modal_1");if(o&&t&&"string"==typeof t){o.innerHTML=t+"&ensp;&#8250;";let i="";i="string"==typeof e&&e&&e.includes(t+" ")?'<div class="my2">'+e+"</div>":"string"==typeof e&&e&&!e.includes(t+" ")?'<div class="mt2">'+t+'</div><div class="mb2">'+e+"</div>":'<div class="my2">'+t+".</div>",n.innerHTML="Ваше местоположение: "+i+' Если нет - выберите его, нажав на кнопку "Выбрать"'}o&&!t&&n&&(n.innerHTML='Ваше местоположение неизвестно. </br>Выберите его, нажав на кнопку "Выбрать"',i.checked=!0)}function n({city:t,adress:e="",id:o=""}){let n={city:t,adress:e,id:o};localStorage.setItem("locality",JSON.stringify(n))}async function i(){let t={timeout:5e3};function e(t){const e=t.coords.latitude;let i={long:t.coords.longitude,lat:e};fetch(url_from_coord+"?coord="+long+"_"+i.lat,{credentials:"same-origin",headers:{Accept:"application/json"}}).then((t=>t.json())).then((t=>{return"object"==typeof(e=t)&&"city"in e&&""!=e.city&&"undefined"!=e.city&&"string"==typeof e.city?function({city:t,adress:e,id:i}){o({city:t,adress:e}),n({city:t,adress:e,id:i})}(t):async function(t,{long:e,lat:i},a="json",l="locality",s=1){const c="https://geocode-maps.yandex.ru/1.x/?apikey="+t+"&geocode="+e+","+i+"&format="+a+"&results="+s+"&kind="+l;try{const t=await fetch(c,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`Response status: ${t.status}`);const e=await t.json();let i=e.response.GeoObjectCollection.featureMember[0].GeoObject.name,a=e.response.GeoObjectCollection.featureMember[0].GeoObject.description;i&&a?(o({city:i,adress:a}),n({city:i,adress:a})):console.error("No location data in responce from geocode-maps.yandex.ru")}catch(t){console.error(t.message)}}(yapikey,i);var e})).catch((t=>console.error(t)))}function i(t){switch(o({city:"",adress:""}),t.code){case t.PERMISSION_DENIED:console.error("ERROR! User denied the request for Geolocation.");break;case t.POSITION_UNAVAILABLE:console.error("ERROR! Location information is unavailable.");break;case t.TIMEOUT:console.error("ERROR! The request to get user location timed out.");break;case t.UNKNOWN_ERROR:console.error("ERROR! An unknown error occurred.")}}!async function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e,i,t):(o({city:"",adress:""}),console.warn("WARNING! Geolocation is not supported by this browser."))}()}function a(t){let e=document.querySelector("#shoose_district");e&&e.addEventListener("change",(function(){let e=document.querySelector("#empty_district");e&&e.remove();let i=this.value;if(this.options[this.selectedIndex].text,i){let e=t[i];if(e){let t=e.regions;!function(t){let e='<option value="" id="empty_region">Регион</option>';for(const o of Object.keys(t))e=e+'<option value="'+t[o].id+'">'+t[o].name+"</option>";let o=document.querySelector("#shoose_region");o&&(o.disabled=!1,o.innerHTML=e);let n=document.querySelector("#shoose_city");n&&(n.innerHTML='<option value="">Город</option>')}(t),function(t){let e=document.querySelector("#shoose_region");e&&e.addEventListener("change",(function(){let e=document.querySelector("#empty_region");e&&e.remove();let i=this.value,a=this.options[this.selectedIndex].text;if(i){let e=t[i];if(e){let t=e.cities;t&&function(t){let e='<option value="" id="empty_city">Город</option>';for(const o of Object.keys(t))e=e+'<option value="'+t[o].id+'">'+t[o].name+"</option>";let o=document.querySelector("#shoose_city");o&&(o.disabled=!1,o.innerHTML=e)}(t)}let l=document.querySelector("#shoose_city");l&&l.addEventListener("change",(function(){let t=document.querySelector("#empty_city");t&&t.remove();let e=this.value;!function(t,e,i){let a=document.querySelector("#save_city");a&&a.addEventListener("click",(function(){let a=e;n({city:t,adress:a,id:i}),o({city:t,adress:a});const l=document.getElementById("show_city_select");l&&(l.checked=!1)}))}(this.options[this.selectedIndex].text,a,e)}))}}))}(t)}}}))}!function(){let t=document.querySelector("#location_div");t&&(t.innerHTML=e)}(),document.addEventListener("DOMContentLoaded",(()=>{let t=JSON.parse(localStorage.getItem("locality"));if(t)o({city:t.city,adress:t.adress});else if(city_from_back)if(city_from_back.includes("Местоположение"))i();else{let t=region_from_back??"";o({city:city_from_back,adress:t}),n({city:city_from_back,adress:t})}else console.error('ERROR! Element with id "location" is empty.')})),function(){let t=document.querySelector("#shoose_location");t&&t.addEventListener("click",(function(){document.getElementById("modal_1").checked=!1,fetch(url_from_db,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json",X_FROMDB:"shooseFromDb"}}).then((t=>!0===t.ok&&t.json())).then((t=>{let e=t.district;!function(t){let e='<option value="" id="empty_district">Округ</option>';for(const o of Object.keys(t))e=e+'<option value="'+t[o].id+'">'+t[o].name+"</option>";let o=document.querySelector("#shoose_district");o&&(o.innerHTML=e);let n=document.querySelector("#shoose_region");n&&(n.innerHTML='<option value="">Регион</option>');let i=document.querySelector("#shoose_city");i&&(i.innerHTML='<option value="">Город</option>')}(e),a(e)}))}),!1)}(),document.onkeydown=function(t){if("Escape"==t.key){var e=document.querySelectorAll(".modal > [type=checkbox]");[].forEach.call(e,(function(t){t.checked=!1}))}};
